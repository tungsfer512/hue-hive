{"version":3,"file":"notebook-bundle-a2a4f8506cb55bb7.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./desktop/core/src/desktop/js/apps/editor/components/ko.syntaxDropdown.js","webpack:///./desktop/core/src/desktop/js/apps/notebook/app.js"],"sourcesContent":["function _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n// Licensed to Cloudera, Inc. under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  Cloudera, Inc. licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport * as ko from 'knockout';\nimport $ from 'jquery';\nimport \"../../../ko/components/ko.dropDown\";\nimport componentUtils from \"../../../ko/components/componentUtils\";\nimport DisposableComponent from \"../../../ko/components/DisposableComponent\";\nimport huePubSub from 'utils/huePubSub';\nimport I18n from \"../../../utils/i18n\";\nimport { hueLocalStorage } from 'utils/storageUtils';\nexport var SYNTAX_DROPDOWN_COMPONENT = 'sql-syntax-dropdown';\nexport var SYNTAX_DROPDOWN_ID = 'sqlSyntaxDropdown';\nexport var SHOW_EVENT = 'sql.syntax.dropdown.show';\nexport var SHOWN_EVENT = 'sql.syntax.dropdown.shown';\nexport var HIDE_EVENT = 'sql.syntax.dropdown.hide';\n\n// prettier-ignore\nvar TEMPLATE = \"\\n<div class=\\\"hue-syntax-drop-down\\\" data-bind=\\\"\\n  style: {\\n    'left': left() + 'px',\\n    'top': top() + 'px'\\n  },\\n  component: {\\n    name: 'hue-drop-down',\\n    params: {\\n      value: selected,\\n      entries: expected,\\n      foreachVisible: false,\\n      searchable: false,\\n      showOnInit: true,\\n      menuOnly: true\\n    }\\n  }\\n\\\"></div>\\n\";\nvar hideSyntaxDropdown = function hideSyntaxDropdown() {\n  var $sqlSyntaxDropdown = $(\"#\".concat(SYNTAX_DROPDOWN_ID));\n  if ($sqlSyntaxDropdown.length) {\n    ko.cleanNode($sqlSyntaxDropdown[0]);\n    $sqlSyntaxDropdown.remove();\n    $(document).off('click', hideOnClickOutside);\n  }\n};\nvar hideOnClickOutside = function hideOnClickOutside(event) {\n  var $modal = $('.modal');\n  if ($.contains(document, event.target) && !$.contains($(\"#\".concat(SYNTAX_DROPDOWN_ID))[0], event.target) && ($modal[0].length === 0 || !$.contains($modal[0], event.target))) {\n    hideSyntaxDropdown();\n  }\n};\nvar SqlSyntaxDropdownViewModel = /*#__PURE__*/function (_DisposableComponent) {\n  function SqlSyntaxDropdownViewModel(params) {\n    var _this;\n    _classCallCheck(this, SqlSyntaxDropdownViewModel);\n    _this = _callSuper(this, SqlSyntaxDropdownViewModel);\n    _this.selected = ko.observable();\n    var expected = params.data.expected.map(function (expected) {\n      return expected.text;\n    });\n    // TODO: Allow suppression of unknown columns etc.\n    if (params.data.ruleId) {\n      if (expected.length > 0) {\n        expected.push({\n          divider: true\n        });\n      }\n      expected.push({\n        label: I18n('Ignore this type of error'),\n        suppressRule: params.data.ruleId.toString() + params.data.text.toLowerCase()\n      });\n    }\n    _this.expected = ko.observableArray(expected);\n    var selectedSub = _this.selected.subscribe(function (newValue) {\n      if (typeof newValue.suppressRule !== 'undefined') {\n        var suppressedRules = hueLocalStorage('hue.syntax.checker.suppressedRules') || {};\n        suppressedRules[newValue.suppressRule] = true;\n        hueLocalStorage('hue.syntax.checker.suppressedRules', suppressedRules);\n        huePubSub.publish('editor.refresh.statement.locations', params.editorId);\n      } else {\n        params.editor.session.replace(params.range, newValue);\n      }\n      hideSyntaxDropdown();\n    });\n    _this.addDisposalCallback(function () {\n      selectedSub.dispose();\n    });\n    _this.left = ko.observable(params.source.left);\n    _this.top = ko.observable(params.source.bottom);\n    var closeOnEsc = function closeOnEsc(e) {\n      if (e.keyCode === 27) {\n        hideSyntaxDropdown();\n      }\n    };\n    $(document).on('keyup', closeOnEsc);\n    _this.addDisposalCallback(function () {\n      $(document).off('keyup', closeOnEsc);\n    });\n    window.setTimeout(function () {\n      $(document).on('click', hideOnClickOutside);\n    }, 0);\n    _this.addDisposalCallback(function () {\n      $(document).off('click', hideOnClickOutside);\n    });\n    return _this;\n  }\n  _inherits(SqlSyntaxDropdownViewModel, _DisposableComponent);\n  return _createClass(SqlSyntaxDropdownViewModel);\n}(DisposableComponent);\ncomponentUtils.registerComponent(SYNTAX_DROPDOWN_COMPONENT, SqlSyntaxDropdownViewModel, TEMPLATE);\nhuePubSub.subscribe(HIDE_EVENT, hideSyntaxDropdown);\nhuePubSub.subscribe(SHOW_EVENT, function (details) {\n  hideSyntaxDropdown();\n  var $sqlSyntaxDropdown = $(\"<div id=\\\"\".concat(SYNTAX_DROPDOWN_ID, \"\\\" data-bind=\\\"component: { name: '\").concat(SYNTAX_DROPDOWN_COMPONENT, \"', params: $data }\\\"></div>\"));\n  $('body').append($sqlSyntaxDropdown);\n  ko.applyBindings(details, $sqlSyntaxDropdown[0]);\n  huePubSub.publish(SHOWN_EVENT);\n});","// Licensed to Cloudera, Inc. under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  Cloudera, Inc. licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport $ from 'jquery';\nimport Clipboard from 'clipboard';\nimport 'jquery-mousewheel';\nimport * as ko from 'knockout';\nimport \"../../ext/bootstrap-datepicker.min\";\nimport \"../../ext/jquery.hotkeys\";\nimport \"../../jquery/plugins/jquery.hdfstree\";\nimport NotebookViewModel from \"./NotebookViewModel\";\nimport \"../editor/components/ko.syntaxDropdown\";\nimport { ACTIVE_SNIPPET_CONNECTOR_CHANGED_EVENT, IGNORE_NEXT_UNLOAD_EVENT } from \"../editor/events\";\nimport { registerHueWorkers } from 'sql/workers/hueWorkerHandler';\nimport huePubSub from 'utils/huePubSub';\nimport I18n from \"../../utils/i18n\";\nimport bootstrapRatios from 'utils/html/bootstrapRatios';\nimport scrollbarWidth from 'utils/screen/scrollbarWidth';\nimport waitForRendered from 'utils/timing/waitForRendered';\nimport { SHOW_LEFT_ASSIST_EVENT } from \"../../ko/components/assist/events\";\nwindow.Clipboard = Clipboard;\nvar HUE_PUB_SUB_EDITOR_ID = window.location.pathname.indexOf('notebook') > -1 ? 'notebook' : 'editor';\nhuePubSub.subscribe('app.dom.loaded', function (app) {\n  if (app === 'editor' && !window.ENABLE_HUE_5 || app === 'notebook') {\n    window.MAIN_SCROLLABLE = '.page-content';\n    var isLeftNavOpen = false;\n    huePubSub.subscribe('left.nav.open.toggle', function (val) {\n      isLeftNavOpen = val;\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('split.panel.resized', function () {\n      huePubSub.publish('recalculate.name.description.width');\n    }, HUE_PUB_SUB_EDITOR_ID);\n    var showHoverMsg = function showHoverMsg(e) {\n      var dt = null;\n      if (e) {\n        dt = e.dataTransfer;\n      }\n      if (!isLeftNavOpen && (!dt || dt.types && (dt.types.indexOf ? dt.types.indexOf('Files') !== -1 : dt.types.contains('Files')))) {\n        $(window.EDITOR_BINDABLE_ELEMENT).find('.hoverMsg').removeClass('hide');\n      }\n    };\n    var hideHoverMsg = function hideHoverMsg(vm) {\n      if (vm.editorMode()) {\n        $(window.EDITOR_BINDABLE_ELEMENT).find('.hoverText').html(I18n('Drop a SQL file here'));\n      } else {\n        $(window.EDITOR_BINDABLE_ELEMENT).find('.hoverText').html(I18n('Drop iPython/Zeppelin notebooks here'));\n      }\n      $(window.EDITOR_BINDABLE_ELEMENT).find('.hoverMsg').addClass('hide');\n    };\n    var createHueDatatable = function createHueDatatable(el, snippet, vm) {\n      var DATATABLES_MAX_HEIGHT = 330;\n      var invisibleRows = 10;\n      if (snippet.result && snippet.result.data() && snippet.result.data().length) {\n        var cols = snippet.result.data()[0].length;\n        invisibleRows = cols > 200 ? 10 : cols > 30 ? 50 : 100;\n      }\n      var _dt = $(el).hueDataTable({\n        i18n: {\n          NO_RESULTS: I18n('No results found.'),\n          OF: I18n('of')\n        },\n        fnDrawCallback: function fnDrawCallback(oSettings) {\n          if (vm.editorMode()) {\n            $('#queryResults').removeAttr('style');\n            DATATABLES_MAX_HEIGHT = $(window).height() - $(el).parent().offset().top - 40;\n            $(el).parents('.dataTables_wrapper').css('overflow-x', 'hidden');\n            $(el).jHueHorizontalScrollbar();\n            $(el).parents('.dataTables_wrapper').jHueScrollLeft();\n          } else if ($(el).data('fnDraws') === 1) {\n            $(el).parents('.dataTables_wrapper').jHueTableScroller({\n              maxHeight: DATATABLES_MAX_HEIGHT,\n              heightAfterCorrection: 0\n            });\n          }\n        },\n        scrollable: vm.editorMode() && !vm.isPresentationMode() ? window.MAIN_SCROLLABLE : '.dataTables_wrapper',\n        contained: !vm.editorMode() || vm.isPresentationMode(),\n        forceInvisible: invisibleRows\n      });\n      window.setTimeout(function () {\n        if (vm.editorMode()) {\n          $(el).parents('.dataTables_wrapper').css('overflow-x', 'hidden');\n          var bannerTopHeight = window.BANNER_TOP_HTML ? 30 : 2;\n          $(el).jHueTableExtender2({\n            mainScrollable: window.MAIN_SCROLLABLE,\n            fixedFirstColumn: vm.editorMode(),\n            stickToTopPosition: 48 + bannerTopHeight,\n            parentId: 'snippet_' + snippet.id(),\n            clonedContainerPosition: 'fixed',\n            app: 'editor'\n          });\n          $(el).jHueHorizontalScrollbar();\n        } else {\n          $(el).jHueTableExtender2({\n            mainScrollable: $(el).parents('.dataTables_wrapper')[0],\n            fixedFirstColumn: vm.editorMode(),\n            parentId: 'snippet_' + snippet.id(),\n            clonedContainerPosition: 'absolute',\n            app: 'editor'\n          });\n        }\n      }, 0);\n      return _dt;\n    };\n    var createDatatable = function createDatatable(el, snippet, vm) {\n      var parent = $(el).parent();\n      // When executing few columns -> many columns -> few columns we have to clear the style\n      $(el).removeAttr('style');\n      if ($(el).hasClass('table-huedatatable')) {\n        $(el).removeClass('table-huedatatable');\n        if (parent.hasClass('dataTables_wrapper')) {\n          $(el).unwrap();\n        }\n      }\n      $(el).addClass('dt');\n      var _dt = createHueDatatable(el, snippet, vm);\n      var dataTableEl = $(el).parents('.dataTables_wrapper');\n      if (!vm.editorMode()) {\n        dataTableEl.bind('mousewheel DOMMouseScroll wheel', function (e) {\n          if ($(el).closest('.results').css('overflow') === 'hidden') {\n            return;\n          }\n          var _e = e.originalEvent,\n            _deltaX = _e.wheelDeltaX || -_e.deltaX,\n            _deltaY = _e.wheelDeltaY || -_e.deltaY;\n          this.scrollTop += -_deltaY / 2;\n          this.scrollLeft += -_deltaX / 2;\n          if (this.scrollTop === 0) {\n            $('body')[0].scrollTop += -_deltaY / 3;\n            $('html')[0].scrollTop += -_deltaY / 3; // for firefox\n          }\n          e.preventDefault();\n        });\n      }\n      var _scrollTimeout = -1;\n      var scrollElement = dataTableEl;\n      if (vm.editorMode()) {\n        scrollElement = $(window.MAIN_SCROLLABLE);\n      }\n      if (scrollElement.data('scrollFnDtCreation')) {\n        scrollElement.off('scroll', scrollElement.data('scrollFnDtCreation'));\n      }\n      var resultFollowTimeout = -1;\n      var dataScroll = function dataScroll() {\n        if (vm.editorMode()) {\n          var snippetEl = $('#snippet_' + snippet.id());\n          if (snippetEl.find('.dataTables_wrapper').length > 0 && snippet.showGrid()) {\n            window.clearTimeout(resultFollowTimeout);\n            resultFollowTimeout = window.setTimeout(function () {\n              var topCoord = vm.isPresentationMode() || vm.isResultFullScreenMode() ? 50 : 73;\n              var offsetTop = 0;\n              if (snippetEl.find('.dataTables_wrapper').length > 0 && snippetEl.find('.dataTables_wrapper').offset()) {\n                offsetTop = (snippetEl.find('.dataTables_wrapper').offset().top - topCoord) * -1;\n              }\n              var margin = Math.max(offsetTop, 0);\n              if (window.BANNER_TOP_HTML) {\n                margin += 31;\n              }\n              if (snippet.isResultSettingsVisible()) {\n                snippetEl.find('.snippet-grid-settings').css({\n                  height: vm.isPresentationMode() || !vm.editorMode() ? '330px' : Math.max(100, Math.ceil($(window).height() - Math.max($('#queryResults').offset().top, topCoord))) + 'px'\n                });\n                snippetEl.find('.result-settings').css({\n                  marginTop: margin\n                });\n              }\n              snippetEl.find('.snippet-actions').css({\n                marginTop: margin + 25\n              });\n            }, 100);\n          }\n        }\n        if (!vm.editorMode() || vm.editorMode() && snippet.currentQueryTab() === 'queryResults' && snippet.showGrid()) {\n          var _lastScrollPosition = scrollElement.data('scrollPosition') != null ? scrollElement.data('scrollPosition') : 0;\n          window.clearTimeout(_scrollTimeout);\n          scrollElement.data('scrollPosition', scrollElement.scrollTop());\n          _scrollTimeout = window.setTimeout(function () {\n            if (vm.editorMode()) {\n              _lastScrollPosition--; //hack for forcing fetching\n            }\n            if (_lastScrollPosition !== scrollElement.scrollTop() && scrollElement.scrollTop() + scrollElement.outerHeight() + 20 >= scrollElement[0].scrollHeight && _dt && snippet.result.hasMore()) {\n              huePubSub.publish('editor.snippet.result.gray', snippet);\n              snippet.fetchResult(100, false);\n            }\n          }, 100);\n        }\n      };\n      scrollElement.data('scrollFnDtCreation', dataScroll);\n      scrollElement.on('scroll', dataScroll);\n      snippet.isResultSettingsVisible.subscribe(function (newValue) {\n        if (newValue) {\n          dataScroll();\n        }\n      });\n      huePubSub.subscribeOnce('chart.hard.reset', function () {\n        // hard reset once the default opened chart\n        var oldChartX = snippet.chartX();\n        snippet.chartX(null);\n        window.setTimeout(function () {\n          snippet.chartX(oldChartX);\n        }, 0);\n      });\n      return _dt;\n    };\n    if (ko.options) {\n      ko.options.deferUpdates = true;\n    }\n    var viewModel;\n    var hideFixedHeaders = function hideFixedHeaders() {\n      $('.jHueTableExtenderClonedContainer').hide();\n      $('.jHueTableExtenderClonedContainerColumn').hide();\n      $('.jHueTableExtenderClonedContainerCell').hide();\n      $('.fixed-header-row').hide();\n      $('.fixed-first-cell').hide();\n      $('.fixed-first-column').hide();\n    };\n    window.hideFixedHeaders = hideFixedHeaders;\n    var redrawTimeout = -1;\n    var redrawFixedHeaders = function redrawFixedHeaders(timeout) {\n      var renderer = function renderer() {\n        if (!viewModel.selectedNotebook()) {\n          return;\n        }\n        viewModel.selectedNotebook().snippets().forEach(function (snippet) {\n          if (snippet.result.meta().length > 0) {\n            var tableExtender = $('#snippet_' + snippet.id() + ' .resultTable').data('plugin_jHueTableExtender2');\n            if (typeof tableExtender !== 'undefined') {\n              tableExtender.repositionHeader();\n              tableExtender.drawLockedRows();\n            }\n            $(window.MAIN_SCROLLABLE).data('lastScroll', $(window.MAIN_SCROLLABLE).scrollTop());\n            $(window.MAIN_SCROLLABLE).trigger('scroll');\n          }\n        });\n        $('.jHueTableExtenderClonedContainer').show();\n        $('.jHueTableExtenderClonedContainerColumn').show();\n        $('.jHueTableExtenderClonedContainerCell').show();\n        $('.fixed-header-row').show();\n        $('.fixed-first-cell').show();\n        $('.fixed-first-column').show();\n      };\n      if (timeout) {\n        window.clearTimeout(redrawTimeout);\n        redrawTimeout = window.setTimeout(renderer, timeout);\n      } else {\n        renderer();\n      }\n    };\n    window.redrawFixedHeaders = redrawFixedHeaders;\n    var replaceAce = function replaceAce(content) {\n      var snip = viewModel.selectedNotebook().snippets()[0];\n      if (snip) {\n        snip.statement_raw(content);\n        snip.result.statements_count(1);\n        snip.ace().setValue(content, 1);\n        snip.result.statement_range({\n          start: {\n            row: 0,\n            column: 0\n          },\n          end: {\n            row: 0,\n            column: 0\n          }\n        });\n        snip.ace()._emit('focus');\n      }\n      hideHoverMsg(viewModel);\n      redrawFixedHeaders(200);\n    };\n    window.replaceAce = replaceAce;\n\n    // Drag and drop iPython / Zeppelin notebooks\n    if (window.FileReader) {\n      var aceChecks = 0;\n      var addAce = function addAce(content, snippetType) {\n        var snip = viewModel.selectedNotebook().addSnippet({\n          type: snippetType,\n          result: {}\n        }, true);\n        snip.statement_raw(content);\n        aceChecks++;\n        snip.checkForAce = window.setInterval(function () {\n          if (snip.ace()) {\n            window.clearInterval(snip.checkForAce);\n            aceChecks--;\n            if (aceChecks === 0) {\n              hideHoverMsg(viewModel);\n              redrawFixedHeaders(200);\n            }\n          }\n        }, 100);\n      };\n      var addMarkdown = function addMarkdown(content) {\n        var snip = viewModel.selectedNotebook().addSnippet({\n          type: 'markdown',\n          result: {}\n        }, true);\n        snip.statement_raw(content);\n      };\n      var addPySpark = function addPySpark(content) {\n        addAce(content, 'pyspark');\n      };\n      var addSql = function addSql(content) {\n        addAce(content, 'hive');\n      };\n      var addScala = function addScala(content) {\n        addAce(content, 'spark');\n      };\n      var parseExternalJSON = function parseExternalJSON(raw) {\n        try {\n          if (viewModel.editorMode()) {\n            replaceAce(raw);\n          } else {\n            var loaded = typeof raw == 'string' ? JSON.parse(raw) : raw;\n            if (loaded.nbformat) {\n              //ipython\n              var cells = [];\n              if (loaded.nbformat === 3) {\n                cells = loaded.worksheets[0].cells;\n              } else if (loaded.nbformat === 4) {\n                cells = loaded.cells;\n              }\n              cells.forEach(function (cell, cellCnt) {\n                window.setTimeout(function () {\n                  if (cell.cell_type === 'code') {\n                    if (loaded.nbformat === 3) {\n                      addPySpark($.isArray(cell.input) ? cell.input.join('') : cell.input);\n                    } else {\n                      addPySpark($.isArray(cell.source) ? cell.source.join('') : cell.source);\n                    }\n                  }\n                  if (cell.cell_type === 'heading') {\n                    var heading = $.isArray(cell.source) ? cell.source.join('') : cell.source;\n                    if (cell.level === 1) {\n                      heading += '\\n====================';\n                    } else if (cell.level === 2) {\n                      heading += '\\n--------------------';\n                    } else {\n                      heading = '### ' + heading;\n                    }\n                    addMarkdown(heading);\n                  }\n                  if (cell.cell_type === 'markdown') {\n                    addMarkdown($.isArray(cell.source) ? cell.source.join('') : cell.source);\n                  }\n                  if (cellCnt === cells.length - 1 && aceChecks === 0) {\n                    hideHoverMsg(viewModel);\n                  }\n                }, 10);\n              });\n            }\n            if (loaded.paragraphs) {\n              //zeppelin\n              if (loaded.name) {\n                viewModel.selectedNotebook().name(loaded.name);\n              }\n              loaded.paragraphs.forEach(function (paragraph) {\n                if (paragraph.text) {\n                  var content = paragraph.text.split('\\n');\n                  if (content[0].indexOf('%md') > -1) {\n                    content.shift();\n                    addMarkdown(content.join('\\n'));\n                  } else if (content[0].indexOf('%sql') > -1 || content[0].indexOf('%hive') > -1) {\n                    content.shift();\n                    addSql(content.join('\\n'));\n                  } else if (content[0].indexOf('%pyspark') > -1) {\n                    content.shift();\n                    addPySpark(content.join('\\n'));\n                  } else {\n                    if (content[0].indexOf('%spark') > -1) {\n                      content.shift();\n                    }\n                    addScala(content.join('\\n'));\n                  }\n                }\n              });\n            }\n          }\n        } catch (e) {\n          hideHoverMsg(viewModel);\n          replaceAce(raw);\n        }\n      };\n      var handleFileSelect = function handleFileSelect(evt) {\n        evt.stopPropagation();\n        evt.preventDefault();\n        var dt = evt.dataTransfer;\n        var files = dt.files;\n        if (files.length > 0) {\n          showHoverMsg();\n        } else {\n          hideHoverMsg(viewModel);\n        }\n        for (var i = 0, f; f = files[i]; i++) {\n          var reader = new FileReader();\n          reader.onload = function (file) {\n            return function (e) {\n              $('.hoverText').html(\"<i class='fa fa-spinner fa-spin'></i>\");\n              parseExternalJSON(e.target.result);\n            };\n          }(f);\n          reader.readAsText(f);\n        }\n      };\n      var handleDragOver = function handleDragOver(evt) {\n        evt.stopPropagation();\n        evt.preventDefault();\n        evt.dataTransfer.dropEffect = 'copy';\n      };\n      var dropZone = $(window.EDITOR_BINDABLE_ELEMENT)[0];\n      dropZone.addEventListener('dragenter', showHoverMsg, false);\n      dropZone.addEventListener('dragover', handleDragOver, false);\n      dropZone.addEventListener('drop', handleFileSelect, false);\n      var isDraggingOverText = false;\n      $(window.EDITOR_BINDABLE_ELEMENT).find('.hoverText').on('dragenter', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n        isDraggingOverText = true;\n      });\n      $(window.EDITOR_BINDABLE_ELEMENT).find('.hoverText').on('dragleave', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n        isDraggingOverText = false;\n      });\n      $(window.EDITOR_BINDABLE_ELEMENT).find('.hoverMsg').on('dragleave', function (e) {\n        if (!isDraggingOverText) {\n          hideHoverMsg(viewModel);\n        }\n      });\n    }\n    if (window.EDITOR_ENABLE_QUERY_SCHEDULING) {\n      viewModel = new NotebookViewModel(window.EDITOR_VIEW_MODEL_OPTIONS, window.CoordinatorEditorViewModel, window.RunningCoordinatorModel);\n    } else {\n      viewModel = new NotebookViewModel(window.EDITOR_VIEW_MODEL_OPTIONS);\n    }\n    ko.applyBindings(viewModel, $(window.EDITOR_BINDABLE_ELEMENT)[0]);\n    viewModel.init();\n    registerHueWorkers();\n    viewModel.selectedNotebook.subscribe(function (newVal) {\n      huePubSub.publish('selected.notebook.changed', newVal);\n    });\n    var wasResultFullScreenMode = false;\n    var isAssistAvailable = viewModel.assistAvailable();\n    var wasLeftPanelVisible = viewModel.isLeftPanelVisible();\n    var wasRightPanelVisible = viewModel.isRightPanelVisible();\n    var exitPlayerMode = function exitPlayerMode() {\n      if (!wasResultFullScreenMode) {\n        viewModel.selectedNotebook().isPresentationMode(false);\n      } else {\n        viewModel.isResultFullScreenMode(false);\n      }\n      wasResultFullScreenMode = false;\n    };\n    viewModel.isResultFullScreenMode.subscribe(function (newValue) {\n      wasResultFullScreenMode = newValue;\n      huePubSub.publish('editor.presentation.operate.toggle', newValue);\n    });\n    viewModel.isLeftPanelVisible.subscribe(function (value) {\n      redrawFixedHeaders(200);\n    });\n    var ignoreNextUnload = false;\n    huePubSub.subscribe(IGNORE_NEXT_UNLOAD_EVENT, function () {\n      ignoreNextUnload = true;\n    });\n\n    // Close the notebook snippets when leaving the page\n    window.onbeforeunload = function (e) {\n      if (ignoreNextUnload) {\n        ignoreNextUnload = false;\n        return;\n      }\n      if (!viewModel.selectedNotebook().avoidClosing) {\n        viewModel.selectedNotebook().close();\n      }\n    };\n    $(window).data('beforeunload', window.onbeforeunload);\n    $('.preview-sample').css('right', 10 + scrollbarWidth() + 'px');\n    var saveKeyHandler = function saveKeyHandler() {\n      if (viewModel.canSave()) {\n        viewModel.saveNotebook();\n      } else {\n        $('#saveAsModal' + window.EDITOR_SUFFIX).modal('show');\n      }\n    };\n    var newKeyHandler = function newKeyHandler() {\n      if (!viewModel.editorMode()) {\n        viewModel.selectedNotebook().newSnippet();\n      } else {\n        viewModel.newNotebook(viewModel.editorType(), null, viewModel.selectedNotebook() ? viewModel.selectedNotebook().snippets()[0].currentQueryTab() : null);\n      }\n    };\n    var initKeydownBindings = function initKeydownBindings() {\n      $(window).bind('keydown.editor', 'ctrl+s alt+s meta+s', function (e) {\n        e.preventDefault();\n        saveKeyHandler();\n        return false;\n      });\n      $(window).bind('keydown.editor', 'ctrl+shift+p alt+shift+p meta+shift+p', function (e) {\n        e.preventDefault();\n        huePubSub.publish('editor.presentation.toggle');\n        return false;\n      });\n      $(window).bind('keydown.editor', 'ctrl+e alt+e meta+e', function (e) {\n        e.preventDefault();\n        newKeyHandler();\n        return false;\n      });\n    };\n    if (document.location.href.indexOf('editor') >= 0) {\n      initKeydownBindings();\n    }\n    $(document).bind('keyup', function (e) {\n      if (e.keyCode === 191 && e.shiftKey && !$(e.target).is('input') && !$(e.target).is('textarea')) {\n        $('#helpModal' + window.EDITOR_SUFFIX).modal('show');\n      }\n      if (e.keyCode === 191 && !e.shiftKey && !$(e.target).is('input') && !$(e.target).is('textarea')) {\n        if (viewModel.editorMode() && viewModel.selectedNotebook().snippets()[0].currentQueryTab() === 'queryResults') {\n          e.preventDefault();\n          var $t = $('#snippet_' + viewModel.selectedNotebook().snippets()[0].id()).find('.resultTable');\n          $t.hueDataTable().fnShowSearch();\n          return false;\n        }\n      }\n    });\n    var initialResizePosition = 100;\n    var draggableHelper = function draggableHelper(el, e, ui, setSize) {\n      var _snippet = ko.dataFor(el.parents('.snippet')[0]);\n      var _cm = $('#snippet_' + _snippet.id()).data('editor');\n      var _newSize = _snippet.aceSize() + (ui.offset.top - initialResizePosition);\n      _cm.setSize('99%', _newSize);\n      if (setSize) {\n        _snippet.aceSize(_newSize);\n      }\n    };\n    var getDraggableOptions = function getDraggableOptions(minY) {\n      return {\n        axis: 'y',\n        start: function start(e, ui) {\n          initialResizePosition = ui.offset.top;\n        },\n        drag: function drag(e, ui) {\n          draggableHelper($(this), e, ui);\n          $('.jHueTableExtenderClonedContainer').hide();\n          $('.jHueTableExtenderClonedContainerColumn').hide();\n          $('.jHueTableExtenderClonedContainerCell').hide();\n          $('.fixed-header-row').hide();\n          $('.fixed-first-cell').hide();\n          $('.fixed-first-column').hide();\n        },\n        stop: function stop(e, ui) {\n          $('.jHueTableExtenderClonedContainer').show();\n          $('.jHueTableExtenderClonedContainerColum').show();\n          $('.jHueTableExtenderClonedContainerCell').show();\n          $('.fixed-header-row').show();\n          $('.fixed-first-cell').show();\n          $('.fixed-first-column').show();\n          draggableHelper($(this), e, ui, true);\n          redrawFixedHeaders();\n          ui.helper.first().removeAttr('style');\n        },\n        containment: [0, minY, 4000, minY + 400]\n      };\n    };\n    $('.resize-panel a').each(function () {\n      $(this).draggable(getDraggableOptions($(this).parents('.snippet').offset().top + 128));\n    });\n    var resetResultsResizer = function resetResultsResizer(snippet) {\n      var $snippet = $('#snippet_' + snippet.id());\n      $snippet.find('.table-results .column-side').width(bootstrapRatios.span3() + '%').data('newWidth', bootstrapRatios.span3());\n      if (snippet.isResultSettingsVisible()) {\n        $snippet.find('.table-results .grid-side').data('newWidth', bootstrapRatios.span9()).width(bootstrapRatios.span9() + '%');\n      } else {\n        $snippet.find('.table-results .grid-side').data('newWidth', 100).width('100%');\n      }\n      $snippet.find('.resize-bar').css('left', '');\n      try {\n        $snippet.find('.resize-bar').draggable('destroy');\n      } catch (e) {}\n      var initialPosition = 0;\n      $snippet.find('.resize-bar').draggable({\n        axis: 'x',\n        containment: $snippet.find('.table-results'),\n        create: function create() {\n          var $snip = $('#snippet_' + snippet.id());\n          initialPosition = $snip.find('.resize-bar').position().left;\n          $snip.find('.table-results .column-side').data('newWidth', bootstrapRatios.span3());\n          $snip.find('.meta-filter').width($snip.find('.table-results .column-side').width() - 28);\n        },\n        drag: function drag(event, ui) {\n          var $snip = $('#snippet_' + snippet.id());\n          if (initialPosition === 0) {\n            initialPosition = $snip.find('.resize-bar').position().left;\n          }\n          ui.position.left = Math.max(150, ui.position.left);\n          var newSpan3Width = ui.position.left * bootstrapRatios.span3() / initialPosition;\n          var newSpan9Width = 100 - newSpan3Width - bootstrapRatios.margin();\n          $snip.find('.table-results .column-side').width(newSpan3Width + '%').data('newWidth', newSpan3Width);\n          $snip.find('.table-results .grid-side').width(newSpan9Width + '%').data('newWidth', newSpan9Width);\n          $snip.find('.meta-filter').width($snip.find('.table-results .column-side').width() - 28);\n        },\n        stop: function stop() {\n          redrawFixedHeaders();\n          huePubSub.publish('resize.leaflet.map');\n        }\n      });\n    };\n    var resizeToggleResultSettings = function resizeToggleResultSettings(snippet, initial) {\n      var _dtElement;\n      var $snip = $('#snippet_' + snippet.id());\n      if (snippet.showGrid()) {\n        _dtElement = $snip.find('.dataTables_wrapper');\n        var topCoord = viewModel.isPresentationMode() || viewModel.isResultFullScreenMode() ? window.BANNER_TOP_HTML ? 31 : 1 : 73;\n        $snip.find('.snippet-grid-settings').css({\n          height: viewModel.isPresentationMode() || !viewModel.editorMode() ? '330px' : Math.ceil($(window).height() - Math.max($('.result-settings').length > 0 ? $('.result-settings').offset().top : 0, topCoord)) + 'px'\n        });\n      } else {\n        _dtElement = $snip.find('.chart:visible');\n      }\n      if (_dtElement.length === 0) {\n        _dtElement = $snip.find('.table-results');\n      }\n      _dtElement.parents('.snippet-body').find('.toggle-result-settings').css({\n        height: _dtElement.height() - 30 + 'px',\n        'line-height': _dtElement.height() - 30 + 'px'\n      });\n      if (initial) {\n        $snip.find('.result-settings').css({\n          marginTop: 0\n        });\n        $snip.find('.snippet-actions').css({\n          marginTop: 0\n        });\n        huePubSub.publish('resize.leaflet.map');\n      }\n    };\n    var forceChartDraws = function forceChartDraws(initial) {\n      if (viewModel.selectedNotebook()) {\n        viewModel.selectedNotebook().snippets().forEach(function (snippet) {\n          if (snippet.result.data().length > 0) {\n            var _elCheckerInterval = -1;\n            var _el = $('#snippet_' + snippet.id());\n            _elCheckerInterval = window.setInterval(function () {\n              if (_el.find('.resultTable').length > 0) {\n                try {\n                  resizeToggleResultSettings(snippet, initial);\n                  resetResultsResizer(snippet);\n                  $(document).trigger('forceChartDraw', snippet);\n                } catch (e) {}\n                window.clearInterval(_elCheckerInterval);\n              }\n            }, 200);\n          }\n        });\n      }\n    };\n    forceChartDraws(true);\n\n    // ======== PubSub ========\n\n    var splitDraggableTimeout = -1;\n    huePubSub.subscribe('split.draggable.position', function () {\n      window.clearTimeout(splitDraggableTimeout);\n      splitDraggableTimeout = window.setTimeout(function () {\n        redrawFixedHeaders(100);\n      }, 200);\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('redraw.fixed.headers', function () {\n      hideFixedHeaders();\n      redrawFixedHeaders(200);\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('app.gained.focus', function (app) {\n      if (app === 'editor') {\n        huePubSub.publish('redraw.fixed.headers');\n        huePubSub.publish('hue.scrollleft.show');\n        huePubSub.publish(ACTIVE_SNIPPET_CONNECTOR_CHANGED_EVENT, viewModel.activeConnector());\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('current.query.tab.switched', function (tab) {\n      if (tab !== 'queryResults') {\n        $('.hue-datatable-search').hide();\n      }\n      if (tab === 'queryHistory') {\n        waitForRendered($('#queryHistory .history-table'), function (el) {\n          return el.is(':visible');\n        }, function () {\n          viewModel.selectedNotebook().forceHistoryInitialHeight(true);\n          huePubSub.publish('editor.calculate.history.height');\n        });\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('detach.scrolls', function (snippet) {\n      var scrollElement = $('#snippet_' + snippet.id()).find('.dataTables_wrapper');\n      if (viewModel.editorMode()) {\n        scrollElement = $(window.MAIN_SCROLLABLE);\n      }\n      if (scrollElement.data('scrollFnDt')) {\n        scrollElement.off('scroll', scrollElement.data('scrollFnDt'));\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.calculate.history.height', function () {\n      if (viewModel.editorMode() && (viewModel.selectedNotebook().historyInitialHeight() === 0 || viewModel.selectedNotebook().forceHistoryInitialHeight())) {\n        var h = $('#queryHistory .history-table').height();\n        if (h === 0) {\n          h = viewModel.selectedNotebook().history().length * 32;\n        }\n        viewModel.selectedNotebook().historyInitialHeight(h + 80); // add pagination too\n        viewModel.selectedNotebook().forceHistoryInitialHeight(false);\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.create.new', newKeyHandler, HUE_PUB_SUB_EDITOR_ID);\n    if (viewModel.isSqlAnalyzerEnabled()) {\n      if (window.SQL_ANALYZER_AUTO_UPLOAD_QUERIES) {\n        huePubSub.subscribe('editor.upload.query', function (query_id) {\n          viewModel.selectedNotebook().snippets()[0].uploadQuery(query_id);\n        }, HUE_PUB_SUB_EDITOR_ID);\n      }\n      if (window.SQL_ANALYZER_AUTO_UPLOAD_DDL) {\n        huePubSub.subscribe('editor.upload.table.stats', function (options) {\n          viewModel.selectedNotebook().snippets()[0].uploadTableStats(options);\n        }, HUE_PUB_SUB_EDITOR_ID);\n      }\n      if (window.SQL_ANALYZER_QUERY_HISTORY_UPLOAD_LIMIT !== 0) {\n        huePubSub.subscribe('editor.upload.history', function () {\n          viewModel.selectedNotebook().snippets()[0].uploadQueryHistory(5);\n        }, HUE_PUB_SUB_EDITOR_ID);\n      }\n    }\n    huePubSub.subscribe('get.selected.notebook', function () {\n      huePubSub.publish('set.selected.notebook', viewModel.selectedNotebook());\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe(SHOW_LEFT_ASSIST_EVENT, function () {\n      if (!viewModel.isLeftPanelVisible() && viewModel.assistAvailable()) {\n        viewModel.isLeftPanelVisible(true);\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('assist.set.manual.visibility', function () {\n      wasLeftPanelVisible = viewModel.isLeftPanelVisible();\n      wasRightPanelVisible = viewModel.isRightPanelVisible();\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.presentation.operate.toggle', function (value) {\n      viewModel.isEditing(!viewModel.isEditing());\n      if (value) {\n        huePubSub.publish('hide.global.alerts');\n        isAssistAvailable = viewModel.assistAvailable();\n        wasLeftPanelVisible = viewModel.isLeftPanelVisible();\n        wasRightPanelVisible = viewModel.isRightPanelVisible();\n        if (wasResultFullScreenMode) {\n          huePubSub.publish('both.assists.hide', true);\n        } else {\n          huePubSub.publish('right.assist.hide', true);\n        }\n        viewModel.assistWithoutStorage(true);\n        viewModel.assistAvailable(false);\n        viewModel.isLeftPanelVisible(true);\n        viewModel.isRightPanelVisible(false);\n        window.setTimeout(function () {\n          viewModel.assistWithoutStorage(false);\n        }, 0);\n        $('.navigator').hide();\n        $('.add-snippet').hide();\n        if (window.BANNER_TOP_HTML) {\n          $('.main-content').attr('style', 'top: 31px !important');\n        } else {\n          $('.main-content').css('top', '1px');\n        }\n        redrawFixedHeaders(200);\n        $(window).bind('keydown', 'esc', exitPlayerMode);\n      } else {\n        hideFixedHeaders();\n        huePubSub.publish('both.assists.revert', true);\n        viewModel.assistWithoutStorage(true);\n        viewModel.isLeftPanelVisible(wasLeftPanelVisible);\n        viewModel.isRightPanelVisible(wasRightPanelVisible);\n        viewModel.assistAvailable(isAssistAvailable);\n        window.setTimeout(function () {\n          viewModel.assistWithoutStorage(false);\n        }, 0);\n        $('.navigator').show();\n        $('.add-snippet').show();\n        if (window.BANNER_TOP_HTML) {\n          $('.main-content').css('top', '112px');\n        } else {\n          $('.main-content').css('top', '74px');\n        }\n        redrawFixedHeaders(200);\n        $(window).unbind('keydown', exitPlayerMode);\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('show.retry.modal', function (data) {\n      $('#retryModal' + window.EDITOR_SUFFIX).modal('show');\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('hide.retry.modal', function (data) {\n      $('#retryModal' + window.EDITOR_SUFFIX).modal('hide');\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('open.link', function (link) {\n      $(window).unbind('keydown.editor');\n      if (link.indexOf('editor') >= 0) {\n        initKeydownBindings();\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.presentation.toggle', function () {\n      viewModel.selectedNotebook().isPresentationMode(!viewModel.isPresentationMode());\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.save', saveKeyHandler, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.render.data', function (options) {\n      var $snip = $('#snippet_' + options.snippet.id());\n      var _el = $snip.find('.resultTable');\n      if (options.data.length > 0) {\n        window.setTimeout(function () {\n          var _dt;\n          if (options.initial) {\n            options.snippet.result.meta.notifySubscribers();\n            $('#snippet_' + options.snippet.id()).find('select').trigger('chosen:updated');\n            _dt = createDatatable(_el, options.snippet, viewModel);\n            resetResultsResizer(options.snippet);\n          } else {\n            _dt = _el.hueDataTable();\n          }\n          try {\n            _dt.fnAddData(options.data);\n          } catch (e) {}\n          var _dtElement = $snip.find('.dataTables_wrapper');\n          huePubSub.publish('editor.snippet.result.normal', options.snippet);\n          _dtElement.scrollTop(_dtElement.data('scrollPosition'));\n          redrawFixedHeaders();\n          resizeToggleResultSettings(options.snippet, options.initial);\n        }, 300);\n      } else {\n        huePubSub.publish('editor.snippet.result.normal', options.snippet);\n      }\n      $snip.find('select').trigger('chosen:updated');\n      $snip.find('.snippet-grid-settings').scrollLeft(0);\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.redraw.data', function (options) {\n      waitForRendered('#snippet_' + options.snippet.id() + ' .resultTable', function (el) {\n        return el.is(':visible');\n      }, function () {\n        var $el = $('#snippet_' + options.snippet.id()).find('.resultTable');\n        var dt = createDatatable($el, options.snippet, viewModel);\n        dt.fnAddData(options.snippet.result.data());\n      });\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.snippet.result.gray', function (snippet) {\n      var $snippet = $('#snippet_' + snippet.id());\n      $snippet.find('.dataTables_wrapper .fixed-first-column').css({\n        opacity: '0'\n      });\n      $snippet.find('.dataTables_wrapper .fixed-header-row').css({\n        opacity: '0'\n      });\n      $snippet.find('.dataTables_wrapper .fixed-first-cell').css({\n        opacity: '0'\n      });\n      $snippet.find('.dataTables_wrapper .resultTable').css({\n        opacity: '0.55'\n      });\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.snippet.result.normal', function (snippet) {\n      var $snippet = $('#snippet_' + snippet.id());\n      $snippet.find('.dataTables_wrapper .fixed-first-column').css({\n        opacity: '1'\n      });\n      $snippet.find('.dataTables_wrapper .fixed-header-row').css({\n        opacity: '1'\n      });\n      $snippet.find('.dataTables_wrapper .fixed-first-cell').css({\n        opacity: '1'\n      });\n      $snippet.find('.dataTables_wrapper .resultTable').css({\n        opacity: '1'\n      });\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('render.jqcron', function () {\n      if (typeof window.renderJqCron !== 'undefined') {\n        window.renderJqCron();\n      }\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('submit.popup.return', function (data) {\n      viewModel.selectedNotebook().viewSchedulerId(data.job_id);\n      $('.submit-modal-editor').modal('hide');\n      huePubSub.publish('show.jobs.panel', {\n        id: data.job_id,\n        \"interface\": data.type\n      });\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('jobbrowser.data', function (jobs) {\n      viewModel.withActiveSnippet(function (snippet) {\n        if (!snippet || snippet.type() === 'impala') {\n          return;\n        }\n        if (jobs.length > 0) {\n          var progress = 0;\n          var parent;\n          jobs.forEach(function (job) {\n            var id = job.shortId || job.id;\n            var el = $('.jobs-overlay li:contains(' + id + ')');\n            if (!el.length) {\n              return;\n            }\n            var context = ko.contextFor(el[0]);\n            parent = context.$parent;\n            var _job = context.$data;\n            progress = parseInt(job.mapsPercentComplete);\n            if (isNaN(progress)) {\n              progress = parseInt(job.progress);\n            }\n            if (!isNaN(progress)) {\n              _job.percentJob(progress);\n            } else {\n              progress = 0;\n            }\n          });\n          if (parent && parent.jobs().length === 1) {\n            parent.progress(Math.max(progress, parent.progress()));\n          }\n        }\n      });\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.get.active.risks', function (callback) {\n      var result = {\n        editor: undefined,\n        risks: {}\n      };\n      if (viewModel.selectedNotebook()) {\n        if (viewModel.selectedNotebook().snippets().length === 1) {\n          result.editor = viewModel.selectedNotebook().snippets()[0].ace();\n          result.risks = viewModel.selectedNotebook().snippets()[0].complexity() || {};\n        } else {\n          viewModel.selectedNotebook().snippets().every(function (snippet) {\n            if (snippet.inFocus()) {\n              result.editor = snippet.ace();\n              result.risks = snippet.complexity() || {};\n              return false;\n            }\n            return true;\n          });\n        }\n      }\n      callback(result);\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.grid.shown', function (snippet) {\n      waitForRendered('#snippet_' + snippet.id() + ' .dataTables_wrapper', function (el) {\n        return el.is(':visible');\n      }, function () {\n        resizeToggleResultSettings(snippet, true);\n        forceChartDraws();\n        $('#snippet_' + snippet.id()).find('.snippet-grid-settings').scrollLeft(0);\n      });\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('editor.chart.shown', function (snippet) {\n      resizeToggleResultSettings(snippet, true);\n    }, HUE_PUB_SUB_EDITOR_ID);\n    huePubSub.subscribe('recalculate.name.description.width', function () {\n      waitForRendered('.editorComponents .hue-title-bar .query-name', function (el) {\n        return el.is(':visible');\n      }, function () {\n        var cumulativeWidth = 0;\n        $('.editorComponents .hue-title-bar ul li:not(.skip-width-calculation)').each(function () {\n          cumulativeWidth += $(this).outerWidth();\n        });\n        $('.notebook-name-desc').css('max-width', ($('.editorComponents .hue-title-bar').width() - cumulativeWidth - $('.editorComponents .hue-title-bar .pull-right').width() - 120) / 2 + 'px');\n      });\n    }, HUE_PUB_SUB_EDITOR_ID);\n    $(document).on('updateResultHeaders', function (e) {\n      hideFixedHeaders();\n      redrawFixedHeaders(200);\n    });\n    $(document).on('showAuthModal', function (e, data) {\n      viewModel.authSessionUsername(window.LOGGED_USERNAME);\n      viewModel.authSessionMessage(data['message']);\n      viewModel.authSessionPassword('');\n      viewModel.authSessionType(data['type']);\n      viewModel.authSessionCallback(data['callback']);\n      $('#authModal' + window.EDITOR_SUFFIX).modal('show');\n    });\n    $(document).on('hideHistoryModal', function (e) {\n      $('#clearHistoryModal' + window.EDITOR_SUFFIX).modal('hide');\n    });\n    $(document).on('toggleResultSettings', function (e, snippet) {\n      window.setTimeout(function () {\n        var $snip = $('#snippet_' + snippet.id());\n        $snip.find('.chart').trigger('forceUpdate');\n        $snip.find('.snippet-grid-settings').scrollLeft(0);\n        if (snippet.isResultSettingsVisible()) {\n          $snip.find('.table-results .grid-side').width(100 - $snip.find('.table-results .column-side').data('newWidth') - bootstrapRatios.margin() + '%');\n        } else {\n          $snip.find('.table-results .grid-side').width('100%');\n        }\n        redrawFixedHeaders();\n        $(window).trigger('resize');\n      }, 10);\n    });\n    $(document).on('editorSizeChanged', function () {\n      window.setTimeout(forceChartDraws, 50);\n    });\n    $(document).on('redrawResults', function () {\n      window.setTimeout(forceChartDraws, 50);\n    });\n    $(document).on('executeStarted', function (e, options) {\n      var $snip = $('#snippet_' + options.snippet.id());\n      var $el = $snip.find('.resultTable');\n      if (options.vm.editorMode()) {\n        $('#queryResults').css({\n          height: $el.height() + 'px'\n        });\n      }\n      $el.data('scrollToCol', null);\n      $el.data('scrollToRow', null);\n      $snip.find('.progress-snippet').animate({\n        height: '3px'\n      }, 100);\n      if ($el.hasClass('dt')) {\n        $el.removeClass('dt');\n        $('#eT' + options.snippet.id() + 'jHueTableExtenderClonedContainer').remove();\n        $('#eT' + options.snippet.id() + 'jHueTableExtenderClonedContainerColumn').remove();\n        $('#eT' + options.snippet.id() + 'jHueTableExtenderClonedContainerCell').remove();\n        if ($el.hueDataTable()) {\n          $el.hueDataTable().fnDestroy();\n        }\n        $el.find('thead tr').empty();\n        $el.data('lockedRows', {});\n      }\n    });\n    $(document).on('renderDataError', function (e, options) {\n      huePubSub.publish('editor.snippet.result.normal', options.snippet);\n    });\n    $(document).on('progress', function (e, options) {\n      if (options.data === 100) {\n        window.setTimeout(function () {\n          $('#snippet_' + options.snippet.id()).find('.progress-snippet').animate({\n            height: '0'\n          }, 100, function () {\n            options.snippet.progress(0);\n            redrawFixedHeaders();\n          });\n        }, 2000);\n      }\n    });\n    $(document).on('forceChartDraw', function (e, snippet) {\n      window.setTimeout(function () {\n        snippet.chartX.notifySubscribers();\n        snippet.chartX.valueHasMutated();\n      }, 100);\n    });\n    var hideTimeout = -1;\n    $(document).on('hideAutocomplete', function () {\n      window.clearTimeout(hideTimeout);\n      hideTimeout = window.setTimeout(function () {\n        var $aceAutocomplete = $('.ace_editor.ace_autocomplete');\n        if ($aceAutocomplete.is(':visible')) {\n          $aceAutocomplete.hide();\n        }\n      }, 100);\n    });\n    var _resizeTimeout = -1;\n    $(window).on('resize', function () {\n      huePubSub.publish('recalculate.name.description.width');\n      window.clearTimeout(_resizeTimeout);\n      _resizeTimeout = window.setTimeout(function () {\n        forceChartDraws();\n      }, 200);\n    });\n  }\n});"],"names":[],"sourceRoot":""}